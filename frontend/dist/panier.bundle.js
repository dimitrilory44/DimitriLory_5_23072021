(()=>{"use strict";!function(){let e=window.location.href,t=new URL(e),n=new URLSearchParams(t.search);if(n.has("_id")){let e=n.get("_id");console.log(e)}}();const e="localhost"===location.hostname||"127.0.0.1"===location.hostname?"http://localhost:3000":"https://api-p5-openclassroom.herokuapp.com",t=JSON.parse(localStorage.getItem("produit"))||[];function n(e){return Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e/100)}async function a(e){let n=e.target.getAttribute("data-index");console.log(n),t.splice(n,1),localStorage.setItem("produit",JSON.stringify(t)),window.location.reload()}async function s(e){let n=e.target.getAttribute("data-index");t[n].quantite<=1?(t.splice(n,1),localStorage.setItem("produit",JSON.stringify(t)),window.location.reload()):(t[n].quantite--,localStorage.setItem("produit",JSON.stringify(t)),window.location.reload())}async function l(e){let n=e.target.getAttribute("data-index");t[n].quantite++,localStorage.setItem("produit",JSON.stringify(t)),window.location.reload()}if(null!==JSON.parse(localStorage.getItem("produit"))?document.getElementById("notification").innerText=JSON.parse(localStorage.getItem("produit")).length:document.getElementById("notification").innerText=0,null===t||0===t.length){const e=document.createElement("section"),t=document.getElementById("main");e.classList.add("jumbotron","d-flex","shadow","bg-body","mt-3","flex-column"),t.appendChild(e);const n=document.createElement("h1");n.classList.add("text-secondary","text-center"),e.appendChild(n),n.innerText="Pas de commande en cours, commencer votre achat";const a=document.createElement("a");a.classList.add("btn","btn-primary"),a.style.width="200px",a.style.margin="20px auto",a.setAttribute("href","../index.html"),a.innerText="Retour au commande",e.appendChild(a)}else{const i=document.createElement("section"),d=document.getElementById("main");i.classList.add("my-5","align-middle"),d.appendChild(i),i.innerHTML='   \n            <div class="d-flex mb-3">\n                <h1>Mon panier</h1>\n            </div>\n\n            <div id="corps" class="card p-3">\n            </div>\n\n            <div class="d-flex justify-content-end mt-3">\n                <h4 class="label mr-5">Total</h4>\n                <div id="total"></div>\n            </div>\n        ',t.forEach((e=>{let a=t.indexOf(e),s=0;s=`${e.prix}`*parseInt(`${e.quantite}`),document.getElementById("corps").innerHTML+=`\n                <div class="d-flex justify-content-end">\n                    <a class="trash" role="button">\n                        <i class="fas fa-trash-alt trash--color" data-index="${a}"></i>\n                    </a>\n                </div>\n                <div class="row d-flex mb-3">\n                  <div class="col-lg-5 col-md-5 col-sm-5">\n                    <img src="${e.img}" class="img-fluid img-thumbnail w-75"/>\n                  </div>\n                  <div class="col-lg-7 col-md-7 col-sm-7 mt-3">\n                    <div class="d-flex justify-content-between">\n                        <div class="d-flex justify-content-start flex-column descriptif">\n                            <a role="button" href="produit.html?_id=${e.id}">\n                                <h3>${e.nom}</h3>\n                            </a>\n                            <span>Ref : ${e.id}</span>\n                            <span class="mb-3">Objectif : ${e.objectif}</span>\n                        </div>\n                    </div>\n                    <div class="d-flex justify-content-between mt-5">\n                        <div class="qty d-flex justify-content-start">\n                            <a class="diminuer" role="button">\n                                <span class="minus bg-dark" data-index="${a}">-</span>\n                            </a>\n                            <span class="qte">${e.quantite}</span>\n                            <a class="augmenter" role="button">\n                                <span class="plus bg-dark" data-index="${a}">+</span>\n                            </a>\n                        </div>\n                        <div class="d-flex justify-content-end price">${n(`${s}`)}</div>\n                    </div>\n                  </div>\n                </div>\n            `})),function(e){let t=0;e.forEach((e=>{t+=e.prix*e.quantite}));document.getElementById("total").innerText+=`${n(t)}`;const a=t.toString();localStorage.setItem("total",a)}(t);let o=document.getElementsByClassName("trash");for(let e of o)e.addEventListener("click",a);let c=document.getElementsByClassName("diminuer");for(let e of c)e.addEventListener("click",s);let r=document.getElementsByClassName("augmenter");for(let e of r)e.addEventListener("click",l);const m=document.createElement("section");m.classList.add("accordion"),d.appendChild(m),m.innerHTML='\n            <div class="d-flex justify-content-end mt-5">\n                <button id="valider" class="btn btn-primary collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">Valider ma commande</button>\n            </div>\n\n            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent=".accordion">\n                <h1 class="mb-3">Validation de ma commande</h1>\n                <form id="orderForm">\n                    <div class="form-row">\n                        <div class="form-group col-md-4">\n                            <label id="inputNom" for="inputNom">Nom</label>\n                            <input type="text" class="form-control" id="nom" placeholder="Entrer un nom">\n                            <small id="errorNom"></small>\n                        </div>\n                        <div class="form-group col-md-4">\n                            <label id="inputPrenom" for="inputPrenom">Prenom</label>\n                            <input type="text" class="form-control" id="prenom" placeholder="Entrer un prenom">\n                            <small id="errorPrenom"></small>\n                        </div>\n                        <div class="form-group col-md-4">\n                            <label id="inputMail" for="inputMail">Email</label>\n                            <input type="email" class="form-control" id="email" placeholder="Entrer un email">\n                            <small id="errorMail"></small>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <div class="form-group col-md-6">\n                            <label id="inputAddress" for="inputAddress">Adresse</label>\n                            <input type="text" class="form-control" id="adresse" placeholder="Ex : 30 rue Orinoco">\n                            <small id="errorAdresse"></small>\n                        </div>\n                        <div class="form-group col-md-6">\n                            <label id="inputCity" for="inputCity">Ville</label>\n                            <input type="text" class="form-control" id="ville" placeholder="Ex : Nantes">\n                            <small id="errorCity"></small>\n                        </div>\n                    </div>\n                    <div class="d-flex justify-content-end">\n                        <button type="submit" id="send" class="btn btn-success">Commander</button>\n                    </div>\n                </form>\n            </div>\n        ';let u=document.getElementById("valider");u.addEventListener("click",(()=>{u.classList.add("d-none")}));let p=new RegExp("^[a-zA-Z0-9.-_]+[@]{1}[a-zA-Z0-9.-_]+[.]{1}[a-z]{2,10}$","g");document.getElementById("send").addEventListener("click",(n=>{n.preventDefault();let a={firstName:document.getElementById("prenom").value,lastName:document.getElementById("nom").value,address:document.getElementById("adresse").value,city:document.getElementById("ville").value,email:document.getElementById("email").value},s=[];if(1==p.test(a.email)&""!==a.firstName&""!==a.lastName&""!==a.address&""!==a.city){for(let e of t)s.push(e.id);!async function(t,n){fetch(`${e}/api/cameras/order`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({contact:t,products:n})}).then((e=>{if(e.ok)return e.json()})).then((e=>{localStorage.setItem("order",JSON.stringify(e)),document.location.href="order.html"})).catch((e=>{alert(e)}))}(a,s)}else!function(e,t){const n=document.getElementById("errorPrenom"),a=document.getElementById("inputPrenom"),s=document.getElementById("prenom");""!==t.firstName?(a.classList.replace("text-danger","text-success"),n.textContent="",n.classList.replace("text-success","text-danger"),s.classList.replace("is-invalid","is-valid")):(a.classList.add("text-danger"),n.textContent="Le champ prenom est obligatoire",n.classList.add("text-danger"),s.classList.add("is-invalid"));const l=document.getElementById("errorNom"),i=document.getElementById("inputNom"),d=document.getElementById("nom");""!==t.lastName?(i.classList.replace("text-danger","text-success"),l.textContent="",l.classList.replace("text-success","text-danger"),d.classList.replace("is-invalid","is-valid")):(i.classList.add("text-danger"),l.textContent="Le champ nom est obligatoire",l.classList.add("text-danger"),d.classList.add("is-invalid"));const o=document.getElementById("errorMail"),c=document.getElementById("inputMail"),r=document.getElementById("email");0==e.test(t.email)?(c.classList.add("text-danger"),o.textContent="Veuillez entrer une adresse mail valide",o.classList.add("text-danger"),r.classList.add("is-invalid")):""!==t.email&&(c.classList.add("text-danger"),o.textContent="Le champ email est obligatoire",o.classList.add("text-danger"),r.classList.add("is-invalid"));const m=document.getElementById("errorAdresse"),u=document.getElementById("inputAddress"),p=document.getElementById("adresse");""!==t.address?(u.classList.replace("text-danger","text-success"),m.textContent="",m.classList.replace("text-success","text-danger"),p.classList.replace("is-invalid","is-valid")):(u.classList.add("text-danger"),m.textContent="Le champ adresse est obligatoire",m.classList.add("text-danger"),p.classList.add("is-invalid"));const g=document.getElementById("errorCity"),f=document.getElementById("inputCity"),x=document.getElementById("ville");""!==t.city?(f.classList.replace("text-danger","text-success"),g.textContent="",g.classList.replace("text-success","text-danger"),x.classList.replace("is-invalid","is-valid")):(f.classList.add("text-danger"),g.textContent="Le champ nom est obligatoire",g.classList.add("text-danger"),x.classList.add("is-invalid"))}(p,a)}))}})();